<!--
Copyright 2017 FileThis, Inc.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->


<link rel="import" href="../ft-scrolling-behavior/ft-scrolling-behavior.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../paper-listbox/paper-listbox.html">
<link rel="import" href="../polymer/polymer.html">

<!--
`<ft-element-demo>`

An element that can be used for the demo fixture for FileThis elements. Has a slot for the element to be demoed and a side bar for configuration options.

@demo
-->
<dom-module id="ft-element-demo">

    <template>

        <style include="iron-flex iron-flex-alignment iron-positioning"></style>

        <style>
            :host {
                display:block;
            }
        </style>

        <div
                class="layout horizontal"
                style="width:100%; height:100%; ">

            <!-- Config panel -->
            <div
                    class="layout vertical center"
                    style="height:100%; border-right:1px solid #DDD; ">

                <!-- Config slot -->
                <slot name="config"></slot>
            </div>

            <!-- Element panel -->
            <div
                    id="elementPanel"
                    style="width:100%; height:100%; ">

                <!-- Size header -->
                <div
                        class="layout vertical center">

                    <!-- Size header -->
                    <div
                            id="sizeHeader"
                            class="layout horizontal center"
                            style="padding-top:5px; padding-bottom:10px; ">

                        <!-- Menu -->
                        <paper-dropdown-menu label="Viewport Size" style="width:130px; ">
                            <paper-listbox
                                    class="dropdown-content"
                                    slot="dropdown-content"
                                    selected="{{_selectedViewportSizeIndex}}">
                                <template is="dom-repeat" items="[[_viewportSizes]]" as="viewportSize">
                                    <paper-item>[[viewportSize.name]]</paper-item>
                                </template>
                            </paper-listbox>
                        </paper-dropdown-menu>

                        <div id="spacer" style="width:30px; "></div>

                        <!-- Size display -->
                        <div>
                            ([[_viewportWidth]] x [[_viewportHeight]])
                        </div>

                    </div>
                </div>

                <!-- Fake viewport -->
                <div
                        id="fakeViewport"
                        class="layout vertical center"
                        style="overflow:auto; ">

                    <!-- Element slot -->
                    <slot name="element"></slot>
                </div>
            </div>

        </div>

    </template>

    <script>
        Polymer({

            is: 'ft-element-demo',

            behaviors: [
                FileThis.ScrollingBehavior
            ],

            listeners:
            {
                'iron-resize': '_onIronResizeThis'
            },

            properties: {

                _viewportWidth:
                    {
                        type: Number
                    },

                _viewportHeight:
                    {
                        type: Number
                    },

                _isFullSize:
                    {
                        type: Boolean,
                        value: true
                    },

                // Viewport sizes ----------------------------

                _viewportSizes:
                    {
                        type: Array,
                        notify: true,
                        value: [
                            {
                                name: "Full",
                                width: 0,
                                height: 0
                            },
                            {
                                name: "Galaxy S5",
                                width: 360,
                                height: 640
                            },
                            {
                                name: "Nexus",
                                width: 412,
                                height: 732
                            },
                            {
                                name: "iPhone 5",
                                width: 320,
                                height: 568
                            },
                            {
                                name: "iPhone 6",
                                width: 375,
                                height: 667
                            },
                            {
                                name: "iPhone 6 Plus",
                                width: 414,
                                height: 736
                            },
                            {
                                name: "iPad",
                                width: 768,
                                height: 1024
                            },
                            {
                                name: "iPad Pro",
                                width: 1024,
                                height: 1366
                            }
                        ]
                    },

                _selectedViewportSizeIndex:
                    {
                        type: Number,
                        notify: true,
                        value: 0,
                        observer: "_onSelectedViewportSizeIndexChanged"
                    }
            },

            ready: function()
            {
                this._manageScroller(this.$.fakeViewport)
            },

            _calculateScrollerWidth: function(scroller)
            {
                // Don't adjust width
                return -1;
            },

            _calculateScrollerHeight: function(scroller)
            {
                if (!this._isFullSize)
                    return -1; // Don't adjust height

                // Adjust scroller height for height of size header above it
                var sizeHeader = this.$.sizeHeader;
                var sizeHeaderHeight = sizeHeader.offsetTop + sizeHeader.offsetHeight + 1;
                return this.clientHeight - sizeHeaderHeight;
            },

            _onIronResizeThis: function(event)
            {
                var viewport = this.$.fakeViewport;
                this._viewportWidth = viewport.offsetWidth;
                this._viewportHeight = viewport.offsetHeight;
            },

            _onSelectedViewportSizeIndexChanged: function(to, from)
            {
                var index = this._selectedViewportSizeIndex;

                if (index === null)
                    return;

                // Full size?
                var isFullSize = (index === 0);
                this._isFullSize = isFullSize;

                var viewport = this.$.fakeViewport;

                if (isFullSize)
                {
                    // Set full size
                    viewport.style.width = "100%";
                    viewport.style.height = "100%";

                    // Border
                    viewport.style.removeProperty("border");
                    viewport.style.borderTop = "1px solid black";

                    // Don't center within parent
                    viewport.style.removeProperty("margin");
                }
                else // fixed size
                {
                    // Set fixed size
                    var viewportSize = this._viewportSizes[index];
                    viewport.style.width = viewportSize.width + "px";
                    viewport.style.height = viewportSize.height + "px";

                    // Border
                    viewport.style.removeProperty("border-top");
                    viewport.style.border = "1px solid black";

                    // Center within parent
                    viewport.style.margin = "auto";
                }
            }

        });

    </script>
</dom-module>
